import matplotlib.pyplot as plt
import numpy as np
from sklearn.metrics import precision_score, recall_score, fbeta_score, make_scorer
from sklearn.model_selection import KFold, StratifiedKFold
from sklearn.model_selection import cross_val_score

import data_plotter as dp

np.random.seed(42)


def validation(estimator, X, y):
    kfold = KFold(10, True, 1)
    s_kfold = StratifiedKFold(10, True, 1)
    acc_scores = cross_val_score(estimator, X, y, cv=s_kfold)
    prec_scores = cross_val_score(estimator, X, y, scoring=make_scorer(precision_score, pos_label='malware'), cv=kfold)
    recall_scores = cross_val_score(estimator, X, y, scoring=make_scorer(recall_score, pos_label='malware'), cv=kfold)
    f1_scores = cross_val_score(estimator, X, y, scoring=make_scorer(fbeta_score, beta=1, pos_label='malware'),
                                cv=kfold)
    plot(estimator, X, y, kfold)
    return np.mean(acc_scores), np.mean(prec_scores), np.mean(recall_scores), np.mean(f1_scores)


def plot(estimator, X, y, cv):
    title = "Learning Curves"
    # Cross validation with 100 iterations to get smoother mean test and train
    # score curves, each time with 20% data randomly selected as a validation set.
    dp.plot_learning_curve(estimator, title, X, y, ylim=(0.7, 1.01), cv=cv, n_jobs=4,
                           train_sizes=np.linspace(0.01, 1.0, 20))
    plt.show()
